---
title: çŠ¶æ€æ¨¡å¼
date: 2019-12-31 16:12:24
disqus: true
---

# çŠ¶æ€æ¨¡å¼ State Pattern

**å…è®¸ä¸€ä¸ªå¯¹è±¡åœ¨å…¶å†…éƒ¨çŠ¶æ€æ”¹å˜æ—¶æ¥æ”¹å˜å®ƒçš„è¡Œä¸ºã€‚**

çŠ¶æ€æ¨¡å¼çš„å…³é”®æ˜¯æŠŠäº‹ç‰©çš„**æ¯ç§çŠ¶æ€éƒ½å°è£…æˆå•ç‹¬çš„ç±»**ï¼Œè·Ÿæ­¤ç§çŠ¶æ€æœ‰å…³çš„è¡Œä¸ºéƒ½è¢«å°è£…åœ¨è¿™ä¸ªç±»çš„å†…éƒ¨ï¼Œåªéœ€è¦åœ¨çŠ¶æ€ç±»çš„ç®¡ç†ç±»ä¸­ï¼ŒæŠŠæŸä¸ªè¯·æ±‚å§”æ‰˜ç»™å½“å‰çš„çŠ¶æ€å¯¹è±¡å³å¯ï¼Œè¯¥çŠ¶æ€å¯¹è±¡ä¼šè´Ÿè´£æ¸²æŸ“å®ƒè‡ªèº«çš„è¡Œä¸ºã€‚

## çŠ¶æ€æ¨¡å¼é€šç”¨ç»“æž„

- **çŠ¶æ€ç®¡ç†ç±»**ï¼šåœ¨è¿™ä¸ªæž„é€ å‡½æ•°å†…éƒ¨ï¼Œåˆå§‹åŒ–æ¯ç§çŠ¶æ€ç±»çš„å®žä¾‹ã€‚çŠ¶æ€ç®¡ç†è€…å°†æŒæœ‰è¿™äº›çŠ¶æ€å¯¹è±¡çš„å¼•ç”¨ï¼Œä»¥ä¾¿æŠŠè¯·æ±‚å§”æ‰˜ç»™çŠ¶æ€å¯¹è±¡ã€‚
- **å„ä¸ªçŠ¶æ€ç±»ï¼š** å°†æ¯ç§çŠ¶æ€å°è£…æˆå•ç‹¬çš„ç±»ï¼Œä¸Žæ­¤çŠ¶æ€æœ‰å…³çš„è¡Œä¸ºéƒ½å°è£…åœ¨è¿™ä¸ªç±»çš„å†…éƒ¨ã€‚

## å®žä¾‹ï¼šçº¢ç»¿ç¯ðŸš¥

**ç¬¬ä¸€æ­¥ï¼ŒçŠ¶æ€ç®¡ç†ç±»ï¼š**

é¦–å…ˆå®šä¹‰äº†`TrafficLight`ç±»ï¼Œåœ¨è¿™é‡Œä¹Ÿè¢«ç§°ä¸ºä¸Šä¸‹æ–‡(`Context`)ã€‚éšåŽåœ¨`TrafficLight`çš„æž„é€ å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬è¦åˆ›å»ºæ¯ä¸€ä¸ªçŠ¶æ€ç±»çš„å®žä¾‹å¯¹è±¡ï¼Œ`Context`å°†æŒæœ‰è¿™äº›çŠ¶æ€å¯¹è±¡çš„å¼•ç”¨ï¼Œä»¥ä¾¿æŠŠè¯·æ±‚å§”æ‰˜ç»™çŠ¶æ€å¯¹è±¡ã€‚

```javascript
class TrafficLight {
  constructor() {
    this.states = [new GreenLight(), new RedLight(), new YellowLight()];
    this.current = this.states[0];
  }

  change() {
    const totalStates = this.states.length;
    let currentIndex = this.states.findIndex(light => light === this.current);
    if (currentIndex + 1 < totalStates) this.current = this.states[currentIndex + 1];
    else this.current = this.states[0];
  }

  sign() {
    return this.current.sign();
  }
}
```

**ç¬¬äºŒæ­¥ï¼Œå°è£…å„ä¸ªçŠ¶æ€ç±»ï¼š**

```javascript
// åŸºç±» Light
class Light {
  constructor(light) {
    this.light = light;
  }
}

// çº¢ç¯
class RedLight extends Light {
  constructor() {
    super('red');
  }

  sign() {
    return 'STOP';
  }
}

// é»„ç¯
class YellowLight extends Light {
  constructor() {
    super('yellow');
  }

  sign() {
    return 'STEADY';
  }
}

// ç»¿ç¯
class GreenLight extends Light {
	constructor() {
		super('green');
	}

	sign() {
		return 'GO';
	}
}
```

è¿™é‡Œå°è£…äº†ä¸‰ç§çŠ¶æ€çº¢ç»¿é»„ç¯ï¼Œå¹¶ä¸”æ¯ç§çŠ¶æ€æœ‰è‡ªå·±çš„è¡Œä¸ºã€‚

Usage:

```javascript
// usage
const trafficLight = new TrafficLight();

console.log(trafficLight.sign()); // 'GO'
trafficLight.change();

console.log(trafficLight.sign()); // 'STOP'
trafficLight.change();

console.log(trafficLight.sign()); // 'STEADY'
trafficLight.change();

console.log(trafficLight.sign()); // 'GO'
trafficLight.change();

console.log(trafficLight.sign()); // 'STOP'
```

#### æ•èŽ·å¼‚å¸¸ï¼šç»§æ‰¿æŠ½è±¡çˆ¶ç±»

JavaScriptæ—¢ä¸æ”¯æŒæŠ½è±¡ç±»ï¼ˆä¸èƒ½å®žä¾‹åŒ–ï¼Œåªæœ‰æŠ½è±¡æ–¹æ³•ï¼‰ï¼Œä¹Ÿæ²¡æœ‰æŽ¥å£çš„æ¦‚å¿µã€‚æ‰€ä»¥åœ¨ä½¿ç”¨çŠ¶æ€æ¨¡å¼çš„æ—¶å€™è¦æ ¼å¤–å°å¿ƒï¼Œå¦‚æžœç¼–å†™ä¸€ä¸ªçŠ¶æ€å­ç±»æ—¶ï¼Œå¿˜è®°äº†ç»™è¿™ä¸ªçŠ¶æ€å­ç±»å®žçŽ°signæ–¹æ³•ï¼Œåˆ™ä¼šåœ¨çŠ¶æ€åˆ‡æ¢çš„æ—¶å€™æŠ›å‡ºå¼‚å¸¸ã€‚å› ä¸ºContextæ€»æ˜¯æŠŠè¯·æ±‚å§”æ‰˜ç»™çŠ¶æ€å¯¹è±¡çš„signæ–¹æ³•ã€‚æ‰€ä»¥ï¼Œè¦è®©æŠ½è±¡çˆ¶ç±»çš„æŠ½è±¡æ–¹æ³•ç›´æŽ¥æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œè¿™ä¸ªå¼‚å¸¸è‡³å°‘ä¼šåœ¨ç¨‹åºè¿è¡ŒæœŸé—´å°±è¢«å‘çŽ°ã€‚

```javascript
// åŸºç±» Light
class Light {
  constructor(light) {
    this.light = light;
  }
  
  sign() {
    throw new Error('å½“å‰ç±»è‡ªèº«åº”å®žçŽ°signå‡½æ•°')
  }
}
```

## çŠ¶æ€æ¨¡å¼ä¸Žç­–ç•¥æ¨¡å¼åŒºåˆ«

- ç›¸åŒç‚¹

  ç­–ç•¥æ¨¡å¼å’ŒçŠ¶æ€æ¨¡å¼çš„ç›¸åŒç‚¹æ˜¯ï¼Œå®ƒä»¬éƒ½æœ‰ä¸€ä¸ªä¸Šä¸‹æ–‡ã€ä¸€äº›ç­–ç•¥æˆ–è€…çŠ¶æ€ç±»ï¼Œä¸Šä¸‹æ–‡æŠŠè¯·æ±‚å§”æ‰˜ç»™è¿™äº›ç±»æ¥æ‰§è¡Œã€‚

- ä¸åŒç‚¹

  å®ƒä»¬ä¹‹é—´çš„åŒºåˆ«æ˜¯ç­–ç•¥æ¨¡å¼ä¸­çš„å„ä¸ªç­–ç•¥ç±»ä¹‹é—´æ˜¯å¹³ç­‰åˆå¹³è¡Œçš„ï¼Œå®ƒä»¬ä¹‹é—´æ²¡æœ‰ä»»ä½•è”ç³»ï¼Œæ‰€ä»¥å®¢æˆ·å¿…é¡»ç†ŸçŸ¥è¿™äº›ç­–ç•¥ç±»çš„ä½œç”¨ï¼Œä»¥ä¾¿å®¢æˆ·éšæ—¶å¯ä»¥ä¸»åŠ¨åˆ‡æ¢ç®—æ³•ï¼›è€Œåœ¨çŠ¶æ€æ¨¡å¼ä¸­ï¼ŒçŠ¶æ€å’ŒçŠ¶æ€å¯¹åº”çš„è¡Œä¸ºæ˜¯æ—©å·²è¢«å°è£…å¥½çš„ï¼ŒçŠ¶æ€ä¹‹é—´çš„åˆ‡æ¢ä¹Ÿæ—©è¢«è§„å®šå®Œæˆï¼Œâ€œæ”¹å˜è¡Œä¸ºâ€è¿™ä»¶äº‹æƒ…åœ¨çŠ¶æ€å†…éƒ¨ã€‚
